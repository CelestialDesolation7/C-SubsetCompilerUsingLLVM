# ToyC - C è¯­è¨€å­é›†ç¼–è¯‘å™¨

<div align="center">

**ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ C å­é›†ç¼–è¯‘å™¨ï¼Œæ”¯æŒç¼–è¯‘åˆ° LLVM IR å’Œ RISC-V æ±‡ç¼–**

![C++](https://img.shields.io/badge/C++-20-blue.svg)
![RISC-V](https://img.shields.io/badge/RISC--V-RV32I-green.svg)
![LLVM](https://img.shields.io/badge/LLVM-IR-orange.svg)
![Build](https://img.shields.io/badge/build-passing-brightgreen.svg)

</div>

---

## ğŸ“– ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒæŠ€æœ¯ä¸äº®ç‚¹](#æ ¸å¿ƒæŠ€æœ¯ä¸äº®ç‚¹)
- [æ”¯æŒçš„è¯­è¨€ç‰¹æ€§](#æ”¯æŒçš„è¯­è¨€ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æ‰¹é‡æµ‹è¯•](#æ‰¹é‡æµ‹è¯•)
- [è¾“å‡ºç¤ºä¾‹](#è¾“å‡ºç¤ºä¾‹)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æŠ€æœ¯æ–‡æ¡£](#æŠ€æœ¯æ–‡æ¡£)

---

## é¡¹ç›®ç®€ä»‹

ToyC æ˜¯ä¸€ä¸ªåŸºäºç°ä»£ç¼–è¯‘æŠ€æœ¯å®ç°çš„ **C è¯­è¨€å­é›†ç¼–è¯‘å™¨**ï¼Œé‡‡ç”¨å¤šé˜¶æ®µç¼–è¯‘æ¶æ„ï¼Œæ”¯æŒå°† C ä»£ç ç¼–è¯‘ä¸º **LLVM IR** å’Œ **RISC-V æ±‡ç¼–ä»£ç **ã€‚

### ç¼–è¯‘æµç¨‹

```
C æºä»£ç  â†’ è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ AST â†’ LLVM IR ç”Ÿæˆ â†’ å¯„å­˜å™¨åˆ†é… â†’ RISC-V æ±‡ç¼–
```

### æŠ€æœ¯æ ˆ

- **è¯­è¨€**: C++20
- **ç›®æ ‡æ¶æ„**: RISC-V 32-bit (RV32I)
- **ä¸­é—´è¡¨ç¤º**: LLVM IR (SSA å½¢å¼)
- **å¯„å­˜å™¨åˆ†é…**: çº¿æ€§æ‰«æç®—æ³•

---

## æ ¸å¿ƒæŠ€æœ¯ä¸äº®ç‚¹

### ğŸ¯ 1. å®Œæ•´çš„ç¼–è¯‘å™¨å‰ç«¯

#### è¯æ³•åˆ†æå™¨ (Lexer)
- **æ‰‹å·¥å®ç°**çš„é«˜æ•ˆè¯æ³•åˆ†æå™¨
- æ”¯æŒå•å­—ç¬¦å’Œå¤šå­—ç¬¦è¿ç®—ç¬¦è¯†åˆ«
- å®Œæ•´çš„å…³é”®å­—ã€æ ‡è¯†ç¬¦ã€æ•°å­—å­—é¢é‡å¤„ç†
- æ”¯æŒæ³¨é‡Šå’Œç©ºç™½ç¬¦è¿‡æ»¤

#### è¯­æ³•åˆ†æå™¨ (Parser)
- **é€’å½’ä¸‹é™**è§£æç®—æ³•
- å®Œæ•´çš„è¡¨è¾¾å¼ä¼˜å…ˆçº§å¤„ç†
- æ”¯æŒå¤æ‚æ§åˆ¶æµè¯­å¥åµŒå¥—
- ä½œç”¨åŸŸç®¡ç†å’Œç¬¦å·è¡¨ç»´æŠ¤

#### æŠ½è±¡è¯­æ³•æ ‘ (AST)
- é¢å‘å¯¹è±¡çš„èŠ‚ç‚¹è®¾è®¡
- æ”¯æŒè¯­æ³•æ ‘å¯è§†åŒ–è¾“å‡º
- ç±»å‹æ£€æŸ¥å’Œè¯­ä¹‰åˆ†æ

### ğŸš€ 2. LLVM IR ä»£ç ç”Ÿæˆ

- **SSA å½¢å¼**çš„ä¸­é—´ä»£ç ç”Ÿæˆ
- æ”¯æŒ phi èŠ‚ç‚¹è‡ªåŠ¨æ’å…¥
- **æ§åˆ¶æµå›¾ (CFG)** æ„å»º
- åŸºæœ¬å—ç®¡ç†å’Œè·³è½¬ä¼˜åŒ–
- å‡½æ•°è°ƒç”¨çº¦å®šå®ç°
- **çŸ­è·¯æ±‚å€¼**ä¼˜åŒ–ï¼ˆé€»è¾‘è¿ç®—ç¬¦ `&&`, `||`ï¼‰

### âš¡ 3. å¯„å­˜å™¨åˆ†é…ç®—æ³•

å®ç°äº†ç»å…¸çš„ **çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é…ç®—æ³•** (Linear Scan Register Allocation)ï¼š

#### æ ¸å¿ƒç‰¹æ€§
- **æ´»è·ƒåŒºé—´è®¡ç®—**: ç²¾ç¡®åˆ†æå˜é‡ç”Ÿå‘½å‘¨æœŸ
- **ç‰©ç†å¯„å­˜å™¨æ˜ å°„**: ç¬¦åˆ RISC-V è°ƒç”¨çº¦å®š
  - `a0-a7`: å‚æ•°å¯„å­˜å™¨
  - `t0-t6`: ä¸´æ—¶å¯„å­˜å™¨  
  - `s0-s11`: ä¿å­˜å¯„å­˜å™¨
- **æº¢å‡ºå¤„ç†**: è‡ªåŠ¨æ ˆåˆ†é…å’ŒåŠ è½½/å­˜å‚¨ç”Ÿæˆ
- **å‚æ•°å¤„ç†**: æ”¯æŒå¤šå‚æ•°å‡½æ•°è°ƒç”¨ï¼ˆå‰ 8 ä¸ªé€šè¿‡å¯„å­˜å™¨ï¼Œå…¶ä½™é€šè¿‡æ ˆï¼‰

#### ç®—æ³•ä¼˜åŠ¿
- **æ—¶é—´å¤æ‚åº¦**: O(n log n)ï¼Œè¿œä¼˜äºå›¾ç€è‰²ç®—æ³•
- **ç©ºé—´æ•ˆç‡**: é«˜æ•ˆåˆ©ç”¨å¯„å­˜å™¨ï¼Œå‡å°‘å†…å­˜è®¿é—®
- **å·¥ä¸šçº§å®ç°**: è¢«å¹¿æ³›åº”ç”¨äº JVMã€V8 ç­‰ç”Ÿäº§ç¯å¢ƒ

è¯¦ç»†ç®—æ³•è¯´æ˜è§ï¼š[docs/çº¿æ€§æ‰«æç®—æ³•æ ¸å¿ƒæ€è·¯.md](docs/çº¿æ€§æ‰«æç®—æ³•æ ¸å¿ƒæ€è·¯.md)

### ğŸ”§ 4. RISC-V ä»£ç ç”Ÿæˆ

#### æ”¯æŒçš„æŒ‡ä»¤é›†
- **ç®—æœ¯è¿ç®—**: `add`, `sub`, `mul`, `div`, `rem`
- **é€»è¾‘è¿ç®—**: `and`, `or`, `xor`, `not`
- **æ¯”è¾ƒè¿ç®—**: `slt`, `seqz`, `snez`
- **æ§åˆ¶æµ**: `beq`, `bne`, `blt`, `bge`, `j`, `jal`, `jalr`, `ret`
- **å†…å­˜è®¿é—®**: `lw`, `sw`ï¼ˆå­—å¯¹é½ï¼‰

#### è°ƒç”¨çº¦å®š
å®Œå…¨ç¬¦åˆ **RISC-V ABI** è§„èŒƒï¼š
- å‚æ•°ä¼ é€’ï¼š`a0-a7` (å‰ 8 ä¸ªå‚æ•°)
- è¿”å›å€¼ï¼š`a0`
- è¿”å›åœ°å€ï¼š`ra`
- æ ˆæŒ‡é’ˆï¼š`sp`
- å¸§æŒ‡é’ˆï¼š`s0`ï¼ˆå¯é€‰ï¼‰

### ğŸ¨ 5. å¤šç§è¾“å‡ºæ¨¡å¼

æ”¯æŒçµæ´»çš„ç¼–è¯‘è¾“å‡ºï¼š
- **AST**: æ ‘å½¢ç»“æ„å¯è§†åŒ–
- **LLVM IR**: æ ‡å‡† LLVM IR æ ¼å¼
- **Assembly**: RISC-V æ±‡ç¼–ä»£ç 
- **All**: åŒæ—¶è¾“å‡ºä»¥ä¸Šæ‰€æœ‰å†…å®¹

---

## æ”¯æŒçš„è¯­è¨€ç‰¹æ€§

### æ•°æ®ç±»å‹
- `int` - 32 ä½æœ‰ç¬¦å·æ•´æ•°
- `void` - æ— è¿”å›å€¼ç±»å‹

### è¿ç®—ç¬¦
| ç±»å‹ | è¿ç®—ç¬¦ |
|------|--------|
| ç®—æœ¯ | `+`, `-`, `*`, `/`, `%` |
| æ¯”è¾ƒ | `==`, `!=`, `<`, `>`, `<=`, `>=` |
| é€»è¾‘ | `&&`, `||`, `!` |
| ä¸€å…ƒ | `+`, `-`, `!` |
| èµ‹å€¼ | `=` |

### æ§åˆ¶æµ
- `if` / `if-else` - æ¡ä»¶åˆ†æ”¯
- `while` - å¾ªç¯
- `break` - è·³å‡ºå¾ªç¯
- `continue` - ç»§ç»­ä¸‹æ¬¡è¿­ä»£
- `return` - å‡½æ•°è¿”å›

### é«˜çº§ç‰¹æ€§
- âœ… å‡½æ•°å®šä¹‰å’Œè°ƒç”¨
- âœ… é€’å½’å‡½æ•°æ”¯æŒ
- âœ… å¤šå‚æ•°ä¼ é€’
- âœ… ä½œç”¨åŸŸå’Œå˜é‡é®è”½
- âœ… å—çº§ä½œç”¨åŸŸ `{ ... }`
- âœ… çŸ­è·¯æ±‚å€¼ä¼˜åŒ–
- âœ… è¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **å¿…éœ€**:
  - g++ (æ”¯æŒ C++20)
  - make
  - bash

- **å¯é€‰** (ç”¨äºç”Ÿæˆå¯¹æ¯”è¾“å‡º):
  - clang
  - riscv32-unknown-elf-gcc

### å®‰è£…ä¾èµ– (Ubuntu/WSL)

```bash
sudo apt update
sudo apt install build-essential clang
```

### ç¼–è¯‘é¡¹ç›®

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®å
cd C-SubsetCompilerUsingLLVM

# æ„å»ºç¼–è¯‘å™¨
make build

# æˆ–ç›´æ¥è¿è¡Œæµ‹è¯•ï¼ˆä¼šè‡ªåŠ¨æ„å»ºï¼‰
make test
```

---

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
./toyc <input_file> [options]
```

**é€‰é¡¹è¯´æ˜**:
- `--mode <mode>`: è¾“å‡ºæ¨¡å¼
  - `ast` - æŠ½è±¡è¯­æ³•æ ‘
  - `ir` - LLVM IR
  - `asm` - RISC-V æ±‡ç¼– (é»˜è®¤)
  - `all` - æ‰€æœ‰è¾“å‡º
- `--output <file>`: è¾“å‡ºåˆ°æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º stdoutï¼‰
- `--target <arch>`: ç›®æ ‡æ¶æ„ï¼ˆé»˜è®¤ `riscv32`ï¼‰

### ç¤ºä¾‹ç”¨æ³•

#### 1. ç¼–è¯‘åˆ° RISC-V æ±‡ç¼–

```bash
./toyc examples/compiler_inputs/01_minimal.c --mode asm
```

#### 2. ç”Ÿæˆ LLVM IR

```bash
./toyc examples/compiler_inputs/05_function_call.c --mode ir
```

#### 3. æŸ¥çœ‹ AST

```bash
./toyc examples/compiler_inputs/03_if_else.c --mode ast
```

#### 4. è¾“å‡ºåˆ°æ–‡ä»¶

```bash
./toyc examples/compiler_inputs/09_recursion.c --mode asm --output fib.s
```

#### 5. ä»æ ‡å‡†è¾“å…¥è¯»å–

```bash
cat test.c | ./toyc --mode asm
```

---

## æ‰¹é‡æµ‹è¯•

### é»˜è®¤æµ‹è¯•ï¼ˆæµ‹è¯• examples/compiler_inputsï¼‰

```bash
make test
```

**è¾“å‡ºç»“æ„**:
```
test/
â”œâ”€â”€ asm/                       # æ±‡ç¼–ä»£ç 
â”‚   â”œâ”€â”€ 01_minimal_toyc.s      # ToyC ç”Ÿæˆ
â”‚   â”œâ”€â”€ 01_minimal_clang.s     # Clang ç”Ÿæˆï¼ˆå¯¹æ¯”ï¼‰
â”‚   â””â”€â”€ ...
â””â”€â”€ ir/                        # LLVM IR
    â”œâ”€â”€ 01_minimal_toyc.ll
    â”œâ”€â”€ 01_minimal_clang.ll
    â””â”€â”€ ...
```

### æµ‹è¯•è‡ªå®šä¹‰ç›®å½•

```bash
# æµ‹è¯•æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ .c æ–‡ä»¶
make test TEST_SRC_DIR=path/to/your/test/folder

# ä¾‹å¦‚
make test TEST_SRC_DIR=examples/multi_func
make test TEST_SRC_DIR=examples/single_func
```

### ä»…ç”Ÿæˆæ±‡ç¼–æˆ– IR

```bash
# ä»…æ±‡ç¼–ï¼ˆé»˜è®¤ç›®å½•ï¼‰
bash scripts/generate_asm.sh

# ä»…æ±‡ç¼–ï¼ˆè‡ªå®šä¹‰ç›®å½•ï¼‰
bash scripts/generate_asm.sh examples/single_func

# ä»… IRï¼ˆé»˜è®¤ç›®å½•ï¼‰
bash scripts/generate_ir.sh

# ä»… IRï¼ˆè‡ªå®šä¹‰ç›®å½•ï¼‰
bash scripts/generate_ir.sh examples/multi_func
```

### æ¸…ç†è¾“å‡º

```bash
# æ¸…ç†æ„å»ºäº§ç‰©
make clean

# æ¸…ç†æµ‹è¯•è¾“å‡º
rm -rf test/asm test/ir
```

### éªŒè¯è¾“å‡ºæ­£ç¡®æ€§

**è‡ªåŠ¨ç¼–è¯‘å¹¶è¿è¡Œç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œå¯¹æ¯” ToyC å’Œ Clang çš„æ‰§è¡Œç»“æœ**ï¼š

```bash
# éªŒè¯é»˜è®¤ç›®å½•
make verify

# éªŒè¯è‡ªå®šä¹‰ç›®å½•
make verify TEST_SRC_DIR=examples/single_func
```

**éªŒè¯æµç¨‹**ï¼š
1. è‡ªåŠ¨è°ƒç”¨ `make test` ç”Ÿæˆæ±‡ç¼–ä»£ç 
2. ä½¿ç”¨ RISC-V GCC å°† ToyC å’Œ Clang çš„æ±‡ç¼–ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶
3. ä½¿ç”¨ QEMU ç”¨æˆ·æ¨¡å¼è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶
4. å¯¹æ¯”ä¸¤è€…çš„é€€å‡ºç å’Œè¾“å‡º
5. æ˜¾ç¤º âœ… ç»“æœæ­£ç¡® æˆ– âŒ ç»“æœé”™è¯¯

**ç¯å¢ƒè¦æ±‚**ï¼ˆverify åŠŸèƒ½ï¼‰ï¼š
- `riscv32-unknown-elf-gcc` æˆ– `riscv64-unknown-elf-gcc`: RISC-V äº¤å‰ç¼–è¯‘å™¨
- `qemu-riscv32` æˆ– `qemu-riscv64`: QEMU RISC-V ç”¨æˆ·æ¨¡å¼æ¨¡æ‹Ÿå™¨

**å®‰è£…æ–¹æ³•**ï¼š
```bash
# Ubuntu/Debian
sudo apt install gcc-riscv64-unknown-elf qemu-user

# æ³¨æ„ï¼šè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨å¯ç”¨çš„å·¥å…·é“¾
# riscv64 å·¥å…·é“¾ä¹Ÿå¯ä»¥ç¼–è¯‘ RV32 ä»£ç 
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
=========================================
  ToyC Compiler Output Verification
=========================================
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Testing: 01_minimal
  Clang  exit code: 0
  ToyC   exit code: 0
  âœ… Result: CORRECT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Testing: 05_function_call
  Clang  exit code: 30
  ToyC   exit code: 30
  âœ… Result: CORRECT
=========================================
  Verification Summary
=========================================
Total tests:  15
Passed:       15 âœ…
Failed:       0 âŒ

ğŸ‰ All tests passed!
```

---

## è¾“å‡ºç¤ºä¾‹

### è¾“å…¥ä»£ç  (examples/compiler_inputs/05_function_call.c)

```c
int add(int a, int b) {
    return a + b;
}

int main() {
    int x = 10;
    int y = 20;
    int result = add(x, y);
    return result;
}
```

### AST è¾“å‡º

```
=== Abstract Syntax Tree ===
Function int add(int a, int b)
  Block
    Return
      Binary(+)
        Identifier(a)
        Identifier(b)

Function int main()
  Block
    Decl(x)
      Number(10)
    Decl(y)
      Number(20)
    Decl(result)
      Call(add)
        Identifier(x)
        Identifier(y)
    Return
      Identifier(result)
```

### LLVM IR è¾“å‡º

```llvm
; ModuleID = 'toyc'
source_filename = "toyc"

define i32 @add(i32 %a, i32 %b) {
entry:
  %a_addr = alloca i32
  store i32 %a, i32* %a_addr
  %b_addr = alloca i32
  store i32 %b, i32* %b_addr
  %t0 = load i32, i32* %a_addr
  %t1 = load i32, i32* %b_addr
  %t2 = add i32 %t0, %t1
  ret i32 %t2
}

define i32 @main() {
entry:
  %x_addr = alloca i32
  store i32 10, i32* %x_addr
  %y_addr = alloca i32
  store i32 20, i32* %y_addr
  %result_addr = alloca i32
  %t0 = load i32, i32* %x_addr
  %t1 = load i32, i32* %y_addr
  %t2 = call i32 @add(i32 %t0, i32 %t1)
  store i32 %t2, i32* %result_addr
  %t3 = load i32, i32* %result_addr
  ret i32 %t3
}
```

### RISC-V æ±‡ç¼–è¾“å‡º

```asm
	.text
	.globl	add
	.type	add, @function
add:
	addi	sp, sp, -16
	sw	ra, 12(sp)
	sw	s0, 8(sp)
	addi	s0, sp, 16
	# å‚æ•° a åœ¨ a0, b åœ¨ a1
	add	a0, a0, a1
	lw	ra, 12(sp)
	lw	s0, 8(sp)
	addi	sp, sp, 16
	ret

	.globl	main
	.type	main, @function
main:
	addi	sp, sp, -32
	sw	ra, 28(sp)
	sw	s0, 24(sp)
	addi	s0, sp, 32
	# x = 10
	li	t0, 10
	sw	t0, -12(s0)
	# y = 20
	li	t1, 20
	sw	t1, -16(s0)
	# call add(x, y)
	lw	a0, -12(s0)
	lw	a1, -16(s0)
	call	add
	# result = return value
	sw	a0, -20(s0)
	lw	a0, -20(s0)
	lw	ra, 28(sp)
	lw	s0, 24(sp)
	addi	sp, sp, 32
	ret
```

---

## é¡¹ç›®ç»“æ„

```
C-SubsetCompilerUsingLLVM/
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ main.cpp              # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ lexer.cpp             # è¯æ³•åˆ†æå™¨
â”‚   â”œâ”€â”€ parser.cpp            # è¯­æ³•åˆ†æå™¨
â”‚   â”œâ”€â”€ ast.cpp               # AST èŠ‚ç‚¹å®ç°
â”‚   â”œâ”€â”€ llvm_ir.cpp           # LLVM IR ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ riscv_gen.cpp         # RISC-V ä»£ç ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ ra_linear_scan.cpp    # çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é…
â”‚   â””â”€â”€ include/              # å¤´æ–‡ä»¶
â”‚       â”œâ”€â”€ lexer.h
â”‚       â”œâ”€â”€ parser.h
â”‚       â”œâ”€â”€ ast.h
â”‚       â”œâ”€â”€ llvm_ir.h
â”‚       â”œâ”€â”€ riscv_gen.h
â”‚       â””â”€â”€ ra_linear_scan.h
â”œâ”€â”€ examples/                  # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ compiler_inputs/      # åŸºç¡€æµ‹è¯•é›†ï¼ˆ15ä¸ªç”¨ä¾‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ 01_minimal.c
â”‚   â”‚   â”œâ”€â”€ 02_assignment.c
â”‚   â”‚   â”œâ”€â”€ 03_if_else.c
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ single_func/          # å•å‡½æ•°æµ‹è¯•
â”‚   â””â”€â”€ multi_func/           # å¤šå‡½æ•°æµ‹è¯•
â”œâ”€â”€ scripts/                   # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ generate_asm.sh       # æ‰¹é‡ç”Ÿæˆæ±‡ç¼–
â”‚   â”œâ”€â”€ generate_ir.sh        # æ‰¹é‡ç”Ÿæˆ IR
â”‚   â””â”€â”€ test_instr.sh         # æŒ‡ä»¤æµ‹è¯•
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ æµ‹è¯•æŒ‡å—.md
â”‚   â”œâ”€â”€ çº¿æ€§æ‰«æç®—æ³•æ ¸å¿ƒæ€è·¯.md
â”‚   â””â”€â”€ Debug_Guide_Instr.md
â”œâ”€â”€ test/                      # æµ‹è¯•è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ asm/                  # æ±‡ç¼–è¾“å‡º
â”‚   â””â”€â”€ ir/                   # IR è¾“å‡º
â”œâ”€â”€ build/                     # æ„å»ºäº§ç‰©
â”œâ”€â”€ Makefile                   # æ„å»ºè„šæœ¬
â”œâ”€â”€ README.md                  # æœ¬æ–‡ä»¶
â””â”€â”€ toyc                       # ç¼–è¯‘å™¨å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ„å»ºåï¼‰
```

---

## æŠ€æœ¯æ–‡æ¡£

### ğŸ“š è¯¦ç»†æ–‡æ¡£

- **[æµ‹è¯•æŒ‡å—](docs/æµ‹è¯•æŒ‡å—.md)** - å®Œæ•´çš„æµ‹è¯•è¯´æ˜å’Œå¸¸è§é—®é¢˜
- **[çº¿æ€§æ‰«æç®—æ³•](docs/çº¿æ€§æ‰«æç®—æ³•æ ¸å¿ƒæ€è·¯.md)** - å¯„å­˜å™¨åˆ†é…ç®—æ³•è¯¦è§£
- **[æŒ‡ä»¤è°ƒè¯•æŒ‡å—](docs/Debug_Guide_Instr.md)** - æ±‡ç¼–ä»£ç è°ƒè¯•æ–¹æ³•

### æµ‹è¯•ç”¨ä¾‹è¯´æ˜

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•åŠŸèƒ½ | éš¾åº¦ |
|---------|---------|------|
| `01_minimal.c` | ç©º main å‡½æ•° | â­ |
| `02_assignment.c` | å˜é‡å£°æ˜å’Œèµ‹å€¼ | â­ |
| `03_if_else.c` | æ¡ä»¶åˆ†æ”¯ | â­â­ |
| `04_while_break.c` | å¾ªç¯å’Œ break | â­â­ |
| `05_function_call.c` | å‡½æ•°è°ƒç”¨ | â­â­ |
| `06_continue.c` | continue è¯­å¥ | â­â­ |
| `07_scope_shadow.c` | ä½œç”¨åŸŸå’Œé®è”½ | â­â­â­ |
| `08_short_circuit.c` | çŸ­è·¯æ±‚å€¼ | â­â­â­ |
| `09_recursion.c` | é€’å½’ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰ | â­â­â­ |
| `10_void_fn.c` | void å‡½æ•° | â­â­ |
| `11_precedence.c` | è¿ç®—ç¬¦ä¼˜å…ˆçº§ | â­â­ |
| `12_division_check.c` | é™¤æ³•å’Œå–æ¨¡ | â­â­ |
| `13_scope_block.c` | å—çº§ä½œç”¨åŸŸ | â­â­â­ |
| `14_nested_if_while.c` | åµŒå¥—æ§åˆ¶æµ | â­â­â­ |
| `15_multiple_return_paths.c` | å¤šè¿”å›è·¯å¾„ | â­â­â­ |

---

## å¸¸è§é—®é¢˜ FAQ

### Q1: å¦‚ä½•æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹ï¼Ÿ

å°† `.c` æ–‡ä»¶æ”¾åˆ°ä»»æ„ç›®å½•ï¼Œç„¶åè¿è¡Œï¼š
```bash
make test TEST_SRC_DIR=your/custom/directory
```

### Q2: å¦‚ä½•å¯¹æ¯” ToyC å’Œ Clang çš„è¾“å‡ºï¼Ÿ

```bash
# è¿è¡Œæµ‹è¯•å
diff test/asm/01_minimal_toyc.s test/asm/01_minimal_clang.s

# æˆ–ä½¿ç”¨å¯è§†åŒ–å¯¹æ¯”å·¥å…·
code --diff test/asm/01_minimal_toyc.s test/asm/01_minimal_clang.s
```

### Q3: ç¼–è¯‘æ—¶å‡ºç°è­¦å‘Šæ€ä¹ˆåŠï¼Ÿ

é¡¹ç›®å·²ä¿®å¤ä¸»è¦çš„ç¼–è¯‘è­¦å‘Šã€‚å¦‚æœä»æœ‰è­¦å‘Šï¼Œè¯·ç¡®ä¿ï¼š
- g++ ç‰ˆæœ¬æ”¯æŒ C++20 (`g++ --version`)
- ä½¿ç”¨ `-Wall` ç¼–è¯‘é€‰é¡¹
- æ£€æŸ¥æ˜¯å¦æœ‰æœªä½¿ç”¨çš„å˜é‡æˆ–ä¸åŒ¹é…çš„ç±»å‹

### Q4: æ”¯æŒå“ªäº› RISC-V æŒ‡ä»¤ï¼Ÿ

ç›®å‰æ”¯æŒ **RV32I åŸºç¡€æ•´æ•°æŒ‡ä»¤é›†**ï¼ŒåŒ…æ‹¬ï¼š
- **ç®—æœ¯**: add, sub, mul, div, rem
- **é€»è¾‘**: and, or, xor, slt
- **åˆ†æ”¯**: beq, bne, blt, bge
- **è·³è½¬**: j, jal, jalr, ret
- **å†…å­˜**: lw, sw
- **ç«‹å³æ•°**: li, addi

### Q5: å¦‚ä½•è°ƒè¯•ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Ÿ

å‚è€ƒ [docs/Debug_Guide_Instr.md](docs/Debug_Guide_Instr.md) è·å–è¯¦ç»†çš„è°ƒè¯•æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š
- ä½¿ç”¨ RISC-V æ¨¡æ‹Ÿå™¨
- GDB è°ƒè¯•æŠ€å·§
- å¸¸è§é”™è¯¯æ’æŸ¥

### Q6: æ€§èƒ½å¦‚ä½•ï¼Ÿ

- **ç¼–è¯‘é€Ÿåº¦**: å•æ–‡ä»¶ < 100ms
- **å¯„å­˜å™¨åˆ†é…**: O(n log n) æ—¶é—´å¤æ‚åº¦
- **è¾“å‡ºè´¨é‡**: æ¥è¿‘ Clang -O0 çº§åˆ«ï¼ˆæœªä¼˜åŒ–ï¼‰

### Q7: æµ‹è¯•è„šæœ¬è·³è¿‡ clang æˆ– riscv-gcc æ€ä¹ˆåŠï¼Ÿ

è¿™äº›æ˜¯**å¯é€‰å·¥å…·**ï¼Œä»…ç”¨äºç”Ÿæˆå¯¹æ¯”è¾“å‡ºï¼š
- æ²¡æœ‰ `clang`: ä¼šè·³è¿‡ Clang å¯¹æ¯”è¾“å‡ºï¼ˆä¸å½±å“ ToyC æµ‹è¯•ï¼‰
- æ²¡æœ‰ `riscv32-unknown-elf-gcc`: ä¼šè·³è¿‡ RISC-V GCC è¾“å‡º

ToyC æœ¬èº«çš„æµ‹è¯•ä¸å—å½±å“ã€‚

---

## å¼€å‘è®¡åˆ’

### âœ… å·²å®ç°
- [x] å®Œæ•´çš„ C å­é›†å‰ç«¯
- [x] LLVM IR ç”Ÿæˆï¼ˆSSA å½¢å¼ï¼‰
- [x] çº¿æ€§æ‰«æå¯„å­˜å™¨åˆ†é…
- [x] RISC-V æ±‡ç¼–ç”Ÿæˆ
- [x] å‡½æ•°è°ƒç”¨å’Œé€’å½’
- [x] çŸ­è·¯æ±‚å€¼ä¼˜åŒ–
- [x] æ‰¹é‡æµ‹è¯•æ¡†æ¶

### ğŸš§ è¿›è¡Œä¸­
- [ ] æ•°ç»„æ”¯æŒ
- [ ] æŒ‡é’ˆæ”¯æŒ
- [ ] æ›´å¤šæ•°æ®ç±»å‹ï¼ˆchar, longï¼‰

### ğŸ“‹ è®¡åˆ’ä¸­
- [ ] ä»£ç ä¼˜åŒ– Pass
  - [ ] æ­»ä»£ç æ¶ˆé™¤
  - [ ] å¸¸é‡ä¼ æ’­
  - [ ] å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤
- [ ] æ›´å¤šç›®æ ‡æ¶æ„ï¼ˆx86-64, ARMï¼‰
- [ ] è°ƒè¯•ä¿¡æ¯ç”Ÿæˆï¼ˆDWARFï¼‰

---

## è‡´è°¢ä¸å‚è€ƒ

### ç†è®ºåŸºç¡€
- **Engineering a Compiler** - Keith Cooper & Linda Torczon
- **Modern Compiler Implementation in C** - Andrew W. Appel
- **Compilers: Principles, Techniques, and Tools** - Aho, Lam, Sethi, Ullman

### æŠ€æœ¯å‚è€ƒ
- **LLVM Project** - IR æ ¼å¼å’Œä¼˜åŒ–æŠ€æœ¯
- **RISC-V Foundation** - æŒ‡ä»¤é›†è§„èŒƒå’Œ ABI çº¦å®š
- **Linear Scan Register Allocation** - Massimiliano Poletto & Vivek Sarkar

### å¼€æºé¡¹ç›®
- **TinyC Compiler** - ç®€æ´çš„ C ç¼–è¯‘å™¨å®ç°
- **LLVM Tutorial** - LLVM å®˜æ–¹æ•™ç¨‹

---

## è®¸å¯è¯

æœ¬é¡¹ç›®ä¸º**æ•™å­¦é¡¹ç›®**ï¼Œä»…ç”¨äºå­¦ä¹ ç¼–è¯‘å™¨åŸç†ã€LLVM æŠ€æœ¯å’Œ RISC-V æ¶æ„ã€‚

ä»£ç éµå¾ª MIT è®¸å¯è¯ï¼Œå¯è‡ªç”±ç”¨äºå­¦ä¹ å’Œç ”ç©¶ã€‚

---

<div align="center">

**Happy Compiling! ğŸš€**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Request

---

**é¡¹ç›®äº®ç‚¹**: å®Œæ•´å‰ç«¯ | SSA-IR | çº¿æ€§æ‰«æ | RISC-V æ±‡ç¼– | å·¥ä¸šçº§å®ç°

</div>
